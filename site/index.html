<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ù…Ø¹Ø§ÙŠÙ†Ø© Ù†Ø¸Ø§Ù… ÙØ±ÙŠØ¯ 2026 â€” Ø£ÙˆÙÙ„Ø§ÙŠÙ†</title>

  <!-- Ø®Ø· Tajawal -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;800&display=swap" rel="stylesheet">

  <!-- (Ø§Ø®ØªÙŠØ§Ø±ÙŠ) Ù…Ù„Ù Ù‡ÙˆÙŠØ© Ø®Ø§Ø±Ø¬ÙŠ Ø¥Ù† ÙˆØ¬Ø¯ Ù„Ø¯ÙŠÙƒ -->
  <link rel="stylesheet" href="ui_identity/freed.theme.css">

  <style>
    :root{
      --bg:#0b1220; --panel:#111b2e; --panel2:#0f172a; --muted:#9aa4b2; --text:#e6edf7;
      --primary:#4f46e5; --primary2:#6366f1; --ok:#10b981; --warn:#f59e0b; --bad:#ef4444;
      --border:#21304f; --chip:#16233d;
      --shadow: 0 10px 30px rgba(0,0,0,.25);
      --radius:14px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: "Tajawal", system-ui, -apple-system, Segoe UI, Roboto, Arial, "Noto Sans Arabic", "Noto Kufi Arabic", sans-serif;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; background:linear-gradient(180deg, #070b14, #0b1220 40%, #070b14);
      color:var(--text); font-family:var(--sans); direction:rtl;
    }
    a{color:inherit; text-decoration:none}

    .container{max-width:1280px; margin:0 auto; padding:18px}
    .topbar{
      position:sticky; top:0; z-index:10;
      backdrop-filter: blur(10px);
      background: rgba(7, 11, 20, .75);
      border-bottom:1px solid rgba(33,48,79,.65);
    }
    .brand{
      display:flex; align-items:center; gap:12px; justify-content:space-between;
      padding:14px 18px;
    }
    .brand .left{display:flex; align-items:center; gap:12px}
    .logo{
      width:40px; height:40px; border-radius:12px;
      background: radial-gradient(circle at 30% 30%, var(--primary2), var(--primary));
      display:grid; place-items:center; box-shadow:var(--shadow);
      font-weight:800;
    }
    .titleblock .name{font-weight:800; letter-spacing:.2px}
    .titleblock .sub{color:var(--muted); font-size:12px; margin-top:2px}

    .searchbox{
      display:flex; align-items:center; gap:10px;
      background: rgba(17,27,46,.75);
      border:1px solid rgba(33,48,79,.9);
      padding:10px 12px; border-radius:12px;
      min-width:320px;
    }
    .searchbox input{
      width:100%; border:0; outline:0; background:transparent; color:var(--text);
      font-family:var(--sans);
    }

    .layout{display:grid; grid-template-columns: 270px 1fr; gap:16px; margin-top:16px}
    .sidebar{
      background: rgba(17,27,46,.65);
      border:1px solid rgba(33,48,79,.85);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .nav{padding:10px}
    .nav h4{margin:12px 10px 8px; color:var(--muted); font-size:12px; font-weight:700}
    .nav a{
      display:flex; align-items:center; gap:10px;
      padding:10px 12px;
      border-radius:12px;
      border:1px solid transparent;
      color:var(--text);
    }
    .nav a:hover{background:rgba(79,70,229,.10); border-color:rgba(79,70,229,.25)}
    .nav a.active{background:rgba(79,70,229,.18); border-color:rgba(79,70,229,.35)}
    .nav .icon{width:22px; text-align:center; opacity:.95}

    .main{
      background: rgba(17,27,46,.40);
      border:1px solid rgba(33,48,79,.65);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .content{padding:16px}

    .grid{display:grid; gap:12px}
    .grid.cols-3{grid-template-columns: repeat(3, minmax(0,1fr))}
    .grid.cols-2{grid-template-columns: repeat(2, minmax(0,1fr))}
    .card{
      background: rgba(15,23,42,.75);
      border:1px solid rgba(33,48,79,.75);
      border-radius: var(--radius);
      padding:14px;
    }
    .card h3{margin:0 0 10px; font-size:14px}
    .kpi{display:flex; align-items:flex-end; justify-content:space-between}
    .kpi .val{font-size:26px; font-weight:900}
    .kpi .lbl{color:var(--muted); font-size:12px}

    .badge{
      display:inline-flex; align-items:center; gap:6px;
      padding:6px 10px; border-radius:999px;
      background: rgba(22,35,61,.9); border:1px solid rgba(33,48,79,.9);
      color:var(--muted); font-size:12px; font-weight:650;
      white-space:nowrap;
    }
    .badge.ok{color:#b6f7d8; border-color:rgba(16,185,129,.35); background:rgba(16,185,129,.12)}
    .badge.warn{color:#ffe6b8; border-color:rgba(245,158,11,.35); background:rgba(245,158,11,.12)}
    .badge.bad{color:#ffb9b9; border-color:rgba(239,68,68,.35); background:rgba(239,68,68,.12)}

    .table{
      width:100%; border-collapse:collapse; overflow:hidden; border-radius:12px;
      border:1px solid rgba(33,48,79,.75);
    }
    .table th,.table td{
      padding:10px 10px; text-align:right; font-size:13px;
      border-bottom:1px solid rgba(33,48,79,.55);
      vertical-align:top;
    }
    .table th{color:var(--muted); font-weight:750; background: rgba(15,23,42,.85)}
    .table tr:hover td{background:rgba(79,70,229,.06)}

    .btns{display:flex; gap:8px; flex-wrap:wrap}
    .btn{
      border:1px solid rgba(79,70,229,.35);
      background:rgba(79,70,229,.18);
      color:var(--text);
      padding:8px 10px; border-radius:12px;
      font-weight:750; cursor:pointer;
      font-family:var(--sans);
    }
    .btn:hover{background:rgba(79,70,229,.28)}
    .btn.ghost{background:transparent; border-color:rgba(33,48,79,.85)}
    .btn.ghost:hover{background:rgba(33,48,79,.25)}

    .hr{height:1px; background:rgba(33,48,79,.65); margin:12px 0}
    .small{font-size:12px; color:var(--muted)}
    .row{display:flex; gap:12px; flex-wrap:wrap; align-items:center; justify-content:space-between}
    .chips{display:flex; gap:8px; flex-wrap:wrap}
    .chip{
      background:rgba(22,35,61,.85);
      border:1px solid rgba(33,48,79,.75);
      padding:6px 10px; border-radius:999px;
      font-size:12px; color:var(--muted);
    }

    .modal-backdrop{
      position:fixed; inset:0; background:rgba(0,0,0,.55);
      display:none; align-items:center; justify-content:center; z-index:50;
      padding:16px;
    }
    .modal{
      width:min(1100px, 92vw); max-height:86vh; overflow:auto;
      background: rgba(15,23,42,.96);
      border:1px solid rgba(33,48,79,.85);
      border-radius: 18px;
      box-shadow: var(--shadow);
    }
    .modal header{
      position:sticky; top:0; z-index:1;
      background: rgba(15,23,42,.98);
      border-bottom:1px solid rgba(33,48,79,.7);
      padding:14px 16px;
      display:flex; align-items:flex-start; justify-content:space-between; gap:12px;
    }
    .tabs{display:flex; gap:8px; flex-wrap:wrap}
    .tab{
      padding:8px 10px; border-radius:12px; cursor:pointer;
      border:1px solid rgba(33,48,79,.75);
      background:rgba(22,35,61,.45);
      color:var(--muted); font-weight:750; font-size:12px;
      user-select:none;
    }
    .tab.active{background:rgba(79,70,229,.22); border-color:rgba(79,70,229,.4); color:var(--text)}
    .modal .body{padding:14px 16px}
    pre.code{
      font-family:var(--mono); font-size:12px; line-height:1.5;
      background: rgba(7,11,20,.75);
      border:1px solid rgba(33,48,79,.7);
      padding:12px; border-radius:12px; overflow:auto;
      white-space:pre-wrap;
    }
    .footer-note{
      padding:10px 12px; color:var(--muted); font-size:12px;
      border-top:1px solid rgba(33,48,79,.7);
    }

    @media (max-width: 980px){
      .layout{grid-template-columns: 1fr}
      .searchbox{min-width:unset; width:100%}
      .brand{flex-direction:column; align-items:stretch}
      .brand .left{justify-content:space-between}
    }
  </style>
</head>

<body>
  <div class="topbar">
    <div class="brand">
      <div class="left">
        <div class="logo">Ù</div>
        <div class="titleblock">
          <div class="name" id="sysName">Ù†Ø¸Ø§Ù… ÙØ±ÙŠØ¯ 2026 (Ù…Ø¹Ø§ÙŠÙ†Ø© Ø£ÙˆÙÙ„Ø§ÙŠÙ†)</div>
          <div class="sub" id="sysOrg">â€”</div>
        </div>
      </div>

      <div class="searchbox" title="Ø¨Ø­Ø« Ø³Ø±ÙŠØ¹ Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…Ø¨Ø§Ø¯Ø±Ø§Øª">
        <span style="opacity:.75">ğŸ”</span>
        <input id="q" placeholder="Ø§Ø¨Ø­Ø«: Ù…Ø¨Ø§Ø¯Ø±Ø©ØŒ Ø¥Ø¯Ø§Ø±Ø©ØŒ Ù‡Ø¯Ù ØªØ´ØºÙŠÙ„ÙŠ..." />
        <span class="badge" id="offlineBadge">OFFLINE</span>
      </div>
    </div>
  </div>

  <div class="container">
    <div class="layout">
      <aside class="sidebar">
        <nav class="nav" id="nav">
          <h4>Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©</h4>
          <a href="#/overview" data-route="overview" class="active"><span class="icon">ğŸ </span>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</a>
          <a href="#/strategy" data-route="strategy"><span class="icon">ğŸ¯</span>Ø§Ù„Ø®Ø·Ø© Ø§Ù„Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ©</a>
          <a href="#/initiatives" data-route="initiatives"><span class="icon">ğŸ“Œ</span>Ø§Ù„Ù…Ø¨Ø§Ø¯Ø±Ø§Øª</a>
          <a href="#/timeline" data-route="timeline"><span class="icon">ğŸ—“ï¸</span>Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø²Ù…Ù†ÙŠ</a>
          <a href="#/inventory" data-route="inventory"><span class="icon">ğŸ“¦</span>Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</a>
          <a href="#/donors" data-route="donors"><span class="icon">ğŸ¤</span>Ø§Ù„Ø¬Ù‡Ø§Øª Ø§Ù„Ù…Ø§Ù†Ø­Ø©</a>
          <a href="#/deductions" data-route="deductions"><span class="icon">ğŸ’³</span>Ø§Ù„Ù…Ø³ØªÙ‚Ø·Ø¹ÙŠÙ†</a>
          <a href="#/trainees" data-route="trainees"><span class="icon">ğŸ“</span>Ø§Ù„Ù…ØªØ¯Ø±Ø¨ÙˆÙ†</a>
          <a href="#/expenses" data-route="expenses"><span class="icon">ğŸ§¾</span>Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª Ø§Ù„ØªØ´ØºÙŠÙ„ÙŠØ©</a>
          <a href="#/activity" data-route="activity"><span class="icon">ğŸ“œ</span>Ø³Ø¬Ù„ Ø§Ù„Ù†Ø´Ø§Ø·</a>
          <a href="#/rbac" data-route="rbac"><span class="icon">ğŸ”</span>Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª</a>
          <a href="#/settings" data-route="settings"><span class="icon">âš™ï¸</span>Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</a>
          <div class="hr"></div>
          <div class="small" style="padding:0 10px 10px">
            Ù‡Ø°Ù‡ Ù…Ø¹Ø§ÙŠÙ†Ø© Ø£ÙˆÙÙ„Ø§ÙŠÙ† (Static Prototype) Ù„ÙˆØ§Ø¬Ù‡Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…. Ù„Ø§ ØªØªØ·Ù„Ø¨ Ø£ÙŠ Ø³ÙŠØ±ÙØ±.
          </div>
        </nav>
      </aside>

      <main class="main">
        <div class="content" id="view"></div>
      </main>
    </div>
  </div>

  <!-- Modal -->
  <div class="modal-backdrop" id="modalBackdrop" role="dialog" aria-modal="true">
    <div class="modal" aria-label="Initiative 360">
      <header>
        <div>
          <div style="font-weight:900; font-size:16px" id="mTitle">â€”</div>
          <div class="small" id="mSub">â€”</div>
          <div class="chips" style="margin-top:10px" id="mChips"></div>
        </div>
        <div class="btns">
          <button class="btn ghost" id="mClose">Ø¥ØºÙ„Ø§Ù‚ âœ•</button>
        </div>
      </header>
      <div class="body">
        <div class="tabs" id="mTabs"></div>
        <div class="hr"></div>
        <div id="mBody"></div>
      </div>
      <div class="footer-note" id="mFoot">â€”</div>
    </div>
  </div>

<script>
/**
 * âœ… Ù…Ù‡Ù…:
 * - Ù‡Ø°Ø§ Ø§Ù„Ù…Ù„Ù ÙŠØ¹Ù…Ù„ Ø­ØªÙ‰ Ù„Ùˆ ÙƒØ§Ù†Øª SSOT Ø¶Ø®Ù…Ø© Ø¬Ø¯Ø§Ù‹.
 * - Ù„Ùˆ Ù„Ø¯ÙŠÙƒ SSOT ÙƒØ§Ù…Ù„Ø© (ÙƒØ¨ÙŠØ±Ø©)ØŒ Ø§Ù„ØµÙ‚Ù‡Ø§ Ø¨Ø¯Ù„ DEMO_SSOT Ø¨Ø§Ù„Ø£Ø³ÙÙ„.
 * - Ø£Ùˆ Ø¶Ø¹Ù‡Ø§ ÙÙŠ window.SSOT_DATA Ù‚Ø¨Ù„ Ù‡Ø°Ø§ Ø§Ù„Ø³ÙƒØ±Ø¨Øª.
 */

/* ====== (Ø§Ø®ØªÙŠØ§Ø±ÙŠ) Ø§Ù„ØµÙ‚ SSOT Ø§Ù„Ø¶Ø®Ù…Ø© Ù‡Ù†Ø§ Ø¨Ø¯Ù„ DEMO_SSOT ====== */
const DEMO_SSOT = {
  system_info: {
    name: "ÙØ±ÙŠØ¯ 2026",
    organization: "Ø¬Ù…Ø¹ÙŠØ© Ø¨Ø± Ù…Ø´Ø§Ø±Ù‚",
    license: "1273",
    fiscal_year: { year: 2026, start_date: "2026-01-01", end_date: "2026-12-31", status: "active" },
    version: "5.2.0",
    last_updated: "2026-02-07T23:00:00Z"
  },
  identity: {
    vision: "Ù…Ø¬ØªÙ…Ø¹ Ù…ØªÙ…ÙƒÙ† ÙˆÙ…Ø³ØªØ¯Ø§Ù… Ø®Ø§Ù„Ù Ù…Ù† Ø§Ù„ÙÙ‚Ø± ÙˆØ§Ù„Ø­Ø§Ø¬Ø©",
    mission: "ØªÙ‚Ø¯ÙŠÙ… Ø¨Ø±Ø§Ù…Ø¬ Ù†ÙˆØ¹ÙŠØ© Ù…Ø¨ØªÙƒØ±Ø© Ù„ØªÙ…ÙƒÙŠÙ† Ø§Ù„Ù…Ø³ØªÙÙŠØ¯ÙŠÙ† ÙˆØªØ­Ù‚ÙŠÙ‚ Ø§Ù„Ø§Ø³ØªØ¯Ø§Ù…Ø© Ù…Ù† Ø®Ù„Ø§Ù„ Ø´Ø±Ø§ÙƒØ§Øª ÙØ§Ø¹Ù„Ø© ÙˆØ­ÙˆÙƒÙ…Ø© Ø±Ø´ÙŠØ¯Ø©",
    values: [
      {id:"V1", name:"Ø§Ù„Ø£Ù…Ø§Ù†Ø©", icon:"ğŸ¤²"},
      {id:"V2", name:"Ø§Ù„ØªÙ…ÙŠØ²", icon:"â­"},
      {id:"V3", name:"Ø§Ù„Ø§Ø³ØªØ¯Ø§Ù…Ø©", icon:"ğŸŒ±"},
      {id:"V4", name:"Ø§Ù„Ø´Ø±Ø§ÙƒØ©", icon:"ğŸ¤"},
      {id:"V5", name:"Ø§Ù„Ø§Ø¨ØªÙƒØ§Ø±", icon:"ğŸ’¡"}
    ]
  },
  lookups: {
    perspectives: [
      {id:"P1", code:"P1", name:"Ø§Ù„Ù…Ø§Ù„ÙŠ ÙˆØ§Ù„Ø§Ø³ØªØ¯Ø§Ù…Ø©", icon:"ğŸ’°", order:1},
      {id:"P2", code:"P2", name:"Ø§Ù„Ù…Ø³ØªÙÙŠØ¯ÙˆÙ† ÙˆØ£ØµØ­Ø§Ø¨ Ø§Ù„Ù…ØµÙ„Ø­Ø©", icon:"ğŸ‘¥", order:2},
      {id:"P3", code:"P3", name:"Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ©", icon:"âš™ï¸", order:3},
      {id:"P4", code:"P4", name:"Ø§Ù„ØªØ¹Ù„Ù… ÙˆØ§Ù„Ù†Ù…Ùˆ", icon:"ğŸ“š", order:4}
    ],
    strategic_objectives: [
      {id:"SO1", code:"SO1", name:"Ø§Ù„Ø§Ø³ØªØ¯Ø§Ù…Ø© Ø§Ù„Ù…Ø§Ù„ÙŠØ© ÙˆØªÙ†Ù…ÙŠØ© Ø§Ù„Ù…ÙˆØ§Ø±Ø¯", perspective_id:"P1"},
      {id:"SO4", code:"SO4", name:"Ø§Ù„ØªØ­ÙˆÙ„ Ø§Ù„Ø±Ù‚Ù…ÙŠ ÙˆÙƒÙØ§Ø¡Ø© Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª", perspective_id:"P3"},
      {id:"SO5", code:"SO5", name:"ØªØ­Ù‚ÙŠÙ‚ Ø£Ø«Ø± Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠ Ø¹Ø§Ù„ÙŠ Ø§Ù„Ø¬ÙˆØ¯Ø©", perspective_id:"P2"},
      {id:"SO8", code:"SO8", name:"Ø¨Ù†Ø§Ø¡ Ø§Ù„Ù‚Ø¯Ø±Ø§Øª ÙˆØ§Ù„ØªØ·ÙˆØ¹", perspective_id:"P4"}
    ],
    operational_objectives: [
      {id:"OP1.1", code:"OP1.1", name:"ØªÙ†ÙˆÙŠØ¹ Ù…ØµØ§Ø¯Ø± Ø§Ù„Ø¯Ø®Ù„ ÙˆØ²ÙŠØ§Ø¯Ø© Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø³ØªÙ‚Ø·Ø¹ÙŠÙ† Ø®Ù„Ø§Ù„ Ø§Ù„Ø³Ù†Ø©", so_id:"SO1"},
      {id:"OP4.1", code:"OP4.1", name:"Ø£ØªÙ…ØªØ© Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© ÙˆØ§Ù„ØªÙ‚Ø§Ø±ÙŠØ±", so_id:"SO4"},
      {id:"OP5.1", code:"OP5.1", name:"ØªØ­Ø³ÙŠÙ† Ø¬ÙˆØ¯Ø© ØªÙ†ÙÙŠØ° Ø§Ù„Ù…Ø¨Ø§Ø¯Ø±Ø§Øª Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠØ©", so_id:"SO5"},
      {id:"OP8.2", code:"OP8.2", name:"ØªÙ†ÙÙŠØ° Ø¨Ø±Ø§Ù…Ø¬ ØªØ¯Ø±ÙŠØ¨ ÙˆØ¨Ù†Ø§Ø¡ Ù‚Ø¯Ø±Ø§Øª Ù„Ù„Ù…ÙˆØ¸ÙÙŠÙ† ÙˆØ§Ù„Ù…ØªØ·ÙˆØ¹ÙŠÙ†", so_id:"SO8"}
    ],
    departments: [
      {id:"D1", code:"D1", name:"Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªÙ†ÙÙŠØ°ÙŠØ©", icon:"ğŸ‘¨â€ğŸ’¼"},
      {id:"D2", code:"D2", name:"Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø§Ù„ÙŠØ©", icon:"ğŸ’°"},
      {id:"D6", code:"D6", name:"Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹", icon:"ğŸ“Š"}
    ],
    payment_methods: [
      {id:"PM1", code:"cash", name:"Ù†Ù‚Ø¯ÙŠ", icon:"ğŸ’µ"},
      {id:"PM3", code:"transfer", name:"ØªØ­ÙˆÙŠÙ„ Ø¨Ù†ÙƒÙŠ", icon:"ğŸ¦"},
      {id:"PM5", code:"inventory", name:"ØµØ±Ù Ù…Ù† Ø§Ù„Ù…Ø®Ø²ÙˆÙ†", icon:"ğŸ“¦"}
    ]
  },
  ui_config: {
    currency: { default: "SR" }
  },
  staff: {
    STF001:{id:"STF001", name:"Ø¹Ø·ÙŠÙ‡ Ø§Ù„Ø­Ø±Ø¨ÙŠ", role:"system_admin", role_name:"Ù…Ø¯ÙŠØ± Ø§Ù„Ù†Ø¸Ø§Ù…", department_ids:["D1"], email:"atya@birmashareq.org", phone_masked:"05XX XXX XXX", active:true},
    STF002:{id:"STF002", name:"Ø¹ÙŠØ³Ù‰ Ø§Ù„Ù„Ø¨Ø¯ÙŠ", role:"general_manager", role_name:"Ø§Ù„Ù…Ø¯ÙŠØ± Ø§Ù„Ø¹Ø§Ù…", department_ids:["D1"], email:"issa@birmashareq.org", phone_masked:"05XX XXX XXX", active:true},
    STF004:{id:"STF004", name:"Ø³Ø§Ø±Ø© Ø§Ù„Ø­Ø±Ø¨ÙŠ", role:"data_entry", role_name:"Ù…ÙˆØ¸Ù Ø¥Ø¯Ø®Ø§Ù„", department_ids:["D6"], email:"sarah@birmashareq.org", phone_masked:"05XX XXX XXX", active:true}
  },
  initiatives: {
    I01:{
      id:"I01", code:"I01", name:"Ø§Ù„Ø³Ù„Ø© Ø§Ù„ØºØ°Ø§Ø¦ÙŠØ©", description:"ØªÙˆØ²ÙŠØ¹ Ø³Ù„Ø§Ù„ ØºØ°Ø§Ø¦ÙŠØ© Ø´Ù‡Ø±ÙŠØ© Ù„Ù„Ø£Ø³Ø± Ø§Ù„Ù…Ø³ØªØ­Ù‚Ø©",
      category_id:"CAT1", department_id:"D6", operational_objective_id:"OP5.1",
      funding_type:"unrestricted", target_group:"Ø£Ø³Ø± Ù…Ø­ØªØ§Ø¬Ø©",
      baseline:{value:200, date:"2025-12-31", unit_id:"U1"},
      target:{value:268, unit_id:"U1"},
      dates:{start:"2026-01-01", end:"2026-12-31"},
      milestones:[
        {id:"MS1", title:"Ø§Ø¹ØªÙ…Ø§Ø¯ Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚ ÙˆØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…Ø³ØªÙÙŠØ¯ÙŠÙ†", target_date:"2026-02-28", phase:"ØªØ®Ø·ÙŠØ·", status:"not_started"},
        {id:"MS2", title:"ØªÙ†ÙÙŠØ° Ø§Ù„Ø¯ÙØ¹Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰ (Ø§Ù„Ø±Ø¨Ø¹ Ø§Ù„Ø£ÙˆÙ„)", target_date:"2026-03-31", phase:"ØªÙ†ÙÙŠØ°", status:"not_started"},
        {id:"MS3", title:"Ù…Ø±Ø§Ø¬Ø¹Ø© Ù…Ù†ØªØµÙ Ø§Ù„Ø¹Ø§Ù… ÙˆØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø£Ø«Ø± Ø§Ù„Ù…Ø¨Ø¯Ø¦ÙŠ", target_date:"2026-06-30", phase:"Ù…ØªØ§Ø¨Ø¹Ø©", status:"not_started"},
        {id:"MS4", title:"Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ ÙˆØ¥Ø¹Ø¯Ø§Ø¯ ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø£Ø«Ø±", target_date:"2026-12-15", phase:"Ø¥ØºÙ„Ø§Ù‚", status:"not_started"}
      ],
      indicators:[
        {id:"IND1", name:"Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø³ØªÙÙŠØ¯ÙŠÙ† Ø§Ù„ÙØ¹Ù„ÙŠÙŠÙ†", type:"output", measurement_frequency:"Ø´Ù‡Ø±ÙŠ", unit:"Ø¹Ø¯Ø¯", data_source:"Ù†Ø¸Ø§Ù… ÙØ±ÙŠØ¯"},
        {id:"IND2", name:"Ù†Ø³Ø¨Ø© Ø§Ù„ØªÙ†ÙÙŠØ° Ù…Ù‚Ø§Ø±Ù†Ø© Ø¨Ø§Ù„Ù…Ø³ØªÙ‡Ø¯Ù", type:"efficiency", measurement_frequency:"Ø±Ø¨Ø¹ Ø³Ù†ÙˆÙŠ", unit:"%", data_source:"Ù†Ø¸Ø§Ù… ÙØ±ÙŠØ¯"},
        {id:"IND3", name:"Ù…Ø³ØªÙˆÙ‰ Ø±Ø¶Ø§ Ø§Ù„Ù…Ø³ØªÙÙŠØ¯ÙŠÙ†", type:"outcome", measurement_frequency:"Ù†ØµÙ Ø³Ù†ÙˆÙŠ", unit:"%", data_source:"Ø§Ø³ØªØ¨ÙŠØ§Ù†"}
      ],
      risks:[
        {id:"R1", title:"ØªØ£Ø®Ø± ØªÙˆÙÙŠØ± Ø§Ù„ØªÙ…ÙˆÙŠÙ„ Ø§Ù„ÙƒØ§ÙÙŠ Ù„Ù„Ù…Ø¨Ø§Ø¯Ø±Ø©", probability:"medium", impact:"high", mitigation:"ØªÙ†ÙˆÙŠØ¹ Ù…ØµØ§Ø¯Ø± Ø§Ù„ØªÙ…ÙˆÙŠÙ„ ÙˆØªÙ‚Ø¯ÙŠÙ… Ø·Ù„Ø¨Ø§Øª Ù…Ø¨ÙƒØ±Ø© Ù„Ù„Ù…Ù†Ø­", status:"open", owner:"STF004"}
      ],
      checklist:[
        {id:"CL1", title:"ØªØ¹Ø±ÙŠÙ Ù†Ø·Ø§Ù‚ Ø§Ù„Ù…Ø¨Ø§Ø¯Ø±Ø© ÙˆØ§Ø¹ØªÙ…Ø§Ø¯ Ø§Ù„ÙˆØµÙ", status:"not_started"},
        {id:"CL2", title:"ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ© ÙˆØ®Ø·Ø© Ø§Ù„ØµØ±Ù", status:"not_started"}
      ],
      budget:{estimated_cost:500000, actual_revenues:10500, actual_expenses:14500, currency:"SR"},
      status:"active",
      responsible_staff_id:"STF004",
      visibility:"public"
    },
    I02:{
      id:"I02", code:"I02", name:"Ø£ØªÙ…ØªØ© Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© ÙˆØ§Ù„ØªÙ‚Ø§Ø±ÙŠØ±", description:"Ù…Ø¨Ø§Ø¯Ø±Ø© Ø¯Ø§Ø®Ù„ÙŠØ© Ù„ØªØ­Ø³ÙŠÙ† ÙƒÙØ§Ø¡Ø© Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª",
      department_id:"D1", operational_objective_id:"OP4.1",
      budget:{estimated_cost:120000, actual_revenues:0, actual_expenses:2000, currency:"SR"},
      status:"active",
      responsible_staff_id:"STF001",
      visibility:"system_admin_only",
      checklist:[{id:"CL1", title:"Ø§Ø¹ØªÙ…Ø§Ø¯ Ù†Ø·Ø§Ù‚ Ø§Ù„Ø¹Ù…Ù„", status:"in_progress"}]
    }
  },
  inventory: {
    items: [
      {id:"INV1", name:"Ø³Ù„Ø© ØºØ°Ø§Ø¦ÙŠØ© (Ù…ÙˆØ§Ø¯)", unit:"Ø³Ù„Ø©", qty:120, min:30, last_in:"2026-02-01"},
      {id:"INV2", name:"Ù…ÙŠØ§Ù‡ (ÙƒØ±ØªÙˆÙ†)", unit:"ÙƒØ±ØªÙˆÙ†", qty:60, min:40, last_in:"2026-02-10"}
    ],
    movements: [
      {id:"MOV1", date:"2026-02-12", type:"in", item_id:"INV1", qty:50, note:"ØªÙˆØ±ÙŠØ¯"},
      {id:"MOV2", date:"2026-02-15", type:"out", item_id:"INV1", qty:10, note:"ØµØ±Ù Ù„Ù…Ø¨Ø§Ø¯Ø±Ø© I01", initiative_id:"I01"}
    ]
  },
  donors: {
    entities: [
      {id:"DN1", name:"ÙˆÙ‚Ù Ø§Ù„Ø®ÙŠØ±", type:"Ø¬Ù‡Ø©", pledged:200000, paid:50000, status:"active"},
      {id:"DN2", name:"Ø´Ø±ÙƒØ© Ø£Ù„Ù", type:"Ø´Ø±ÙƒØ©", pledged:100000, paid:100000, status:"completed"}
    ]
  },
  deductions: {
    subscribers: [
      {id:"SUB1", name:"Ù…Ø­Ù…Ø¯", amount:200, status:"active", months_ok:9, last_paid:"2026-02-01"},
      {id:"SUB2", name:"Ø³Ø§Ø±Ø©", amount:150, status:"late", months_ok:3, last_paid:"2025-12-01"}
    ]
  },
  trainees: {
    list: [
      {id:"TR1", name:"Ù…ØªØ¯Ø±Ø¨ 1", program:"ØªØ¯Ø±ÙŠØ¨ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª", start:"2026-02-01", end:"2026-02-28", status:"active"}
    ]
  },
  expenses: {
    ops: [
      {id:"EX1", date:"2026-02-10", title:"Ù‚Ø±Ø·Ø§Ø³ÙŠØ©", amount:850, method:"cash", initiative_id:null, note:"ØªØ´ØºÙŠÙ„ÙŠ"},
      {id:"EX2", date:"2026-02-16", title:"ØµÙŠØ§Ù†Ø©", amount:2300, method:"transfer", initiative_id:"I01", note:"Ù…Ø±ØªØ¨Ø· Ø¨Ù…Ø¨Ø§Ø¯Ø±Ø©"}
    ]
  },
  activity_log: [
    {id:1, ts:"2026-02-07T10:00:00Z", actor:"STF001", action:"self_test_run", details:"ØªØ´ØºÙŠÙ„ Ø§Ø®ØªØ¨Ø§Ø± Ø°Ø§ØªÙŠ"},
    {id:2, ts:"2026-02-08T12:30:00Z", actor:"STF004", action:"initiative_updated", details:"ØªØ­Ø¯ÙŠØ« Ù…Ø¨Ø§Ø¯Ø±Ø© I01: Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ©"}
  ],
  rbac: {
    roles: {
      system_admin:{name:"Ù…Ø¯ÙŠØ± Ø§Ù„Ù†Ø¸Ø§Ù…", permissions:["full_access","manage_settings","self_test"]},
      general_manager:{name:"Ø§Ù„Ù…Ø¯ÙŠØ± Ø§Ù„Ø¹Ø§Ù…", permissions:["view_all_dashboards","view_reports"]},
      data_entry:{name:"Ù…ÙˆØ¸Ù Ø¥Ø¯Ø®Ø§Ù„", permissions:["edit_initiatives","add_expenses","add_revenues"]},
      deduction_officer:{name:"Ù…ÙˆØ¸Ù Ø§Ù„Ø§Ø³ØªÙ‚Ø·Ø§Ø¹", permissions:["manage_deductions","send_whatsapp"]}
    }
  }
};

const SSOT = (window.SSOT_DATA && typeof window.SSOT_DATA === "object") ? window.SSOT_DATA : DEMO_SSOT;

/* ====== Helpers ====== */
const safe = (v)=> (v===null || v===undefined || v==="") ? "â€”" : v;
const fmtDate = (s)=> s ? String(s).replace("T"," ").replace("Z","") : "â€”";
const fmtMoney = (n) => {
  if (n === null || n === undefined || n === "") return "â€”";
  const cur = SSOT.ui_config?.currency?.default || "SR";
  try { return Number(n).toLocaleString('ar-SA') + " " + cur; }
  catch(e){ return String(n) + " " + cur; }
};

function byId(list, id){ return (list||[]).find(x=>x.id===id) || null; }
function deptName(id){
  const d = byId(SSOT.lookups?.departments, id);
  return d ? (d.name) : "â€”";
}
function staffName(id){
  const s = SSOT.staff?.[id];
  return s ? s.name : "â€”";
}
function opName(id){
  const o = byId(SSOT.lookups?.operational_objectives, id);
  return o ? (o.code + " â€” " + o.name) : "â€”";
}
function statusBadge(s){
  const map = {
    active: ["Ù†Ø´Ø·Ø©","ok"],
    pending: ["Ù…Ø¹Ù„Ù‚Ø©","warn"],
    paused: ["Ù…ØªÙˆÙ‚ÙØ©","bad"],
    closed: ["Ù…ØºÙ„Ù‚Ø©","badge"]
  };
  const it = map[s] || ["â€”","badge"];
  return `<span class="badge ${it[1]}">${it[0]}</span>`;
}
function riskBadge(level){
  const l = String(level||"").toLowerCase();
  if(l==="critical") return `<span class="badge bad">Ø­Ø±Ø¬</span>`;
  if(l==="high") return `<span class="badge bad">Ø¹Ø§Ù„ÙŠ</span>`;
  if(l==="medium") return `<span class="badge warn">Ù…ØªÙˆØ³Ø·</span>`;
  if(l==="low") return `<span class="badge ok">Ù…Ù†Ø®ÙØ¶</span>`;
  return `<span class="badge">â€”</span>`;
}

/* ====== Header init ====== */
function initHeader(){
  const si = SSOT.system_info || {};
  document.getElementById('sysName').textContent = (si.name || "Ø§Ù„Ù†Ø¸Ø§Ù…") + " â€” Ù…Ø¹Ø§ÙŠÙ†Ø© Ø£ÙˆÙÙ„Ø§ÙŠÙ†";
  document.getElementById('sysOrg').textContent =
    (si.organization || "â€”") +
    (si.license ? (" â€¢ ØªØ±Ø®ÙŠØµ " + si.license) : "") +
    (si.fiscal_year?.year ? (" â€¢ Ø³Ù†Ø© " + si.fiscal_year.year) : "") +
    (si.version ? (" â€¢ v" + si.version) : "");
}

/* ====== Router ====== */
function setActive(route){
  document.querySelectorAll('#nav a[data-route]').forEach(a=>{
    a.classList.toggle('active', a.dataset.route===route);
  });
}

function route(){
  const hash = location.hash || "#/overview";
  const routeName = hash.replace("#/","").split("?")[0];
  setActive(routeName);

  const view = document.getElementById('view');
  const params = new URLSearchParams(hash.split("?")[1]||"");
  const query = (params.get("q")||"").trim();

  if(routeName==="overview") view.innerHTML = renderOverview();
  else if(routeName==="strategy") view.innerHTML = renderStrategy();
  else if(routeName==="initiatives") view.innerHTML = renderInitiatives(query);
  else if(routeName==="timeline") view.innerHTML = renderTimeline();
  else if(routeName==="inventory") view.innerHTML = renderInventory();
  else if(routeName==="donors") view.innerHTML = renderDonors();
  else if(routeName==="deductions") view.innerHTML = renderDeductions();
  else if(routeName==="trainees") view.innerHTML = renderTrainees();
  else if(routeName==="expenses") view.innerHTML = renderExpenses();
  else if(routeName==="activity") view.innerHTML = renderActivity();
  else if(routeName==="rbac") view.innerHTML = renderRBAC();
  else if(routeName==="settings") view.innerHTML = renderSettings();
  else view.innerHTML = renderOverview();

  wireInitiativeButtons();
}

/* ====== Shared UI pieces ====== */
function kpiCard(title, value, badge){
  return `
    <div class="card">
      <h3>${title}</h3>
      <div class="kpi">
        <div>
          <div class="val">${value}</div>
          <div class="lbl">Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: ${safe(SSOT.system_info?.last_updated)}</div>
        </div>
        <div>${badge||""}</div>
      </div>
    </div>`;
}

function renderInitiativesTable(list){
  const items = (list||[]);
  if(!items.length){
    return `<div class="small">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ø¹Ø±Ø¶Ù‡Ø§.</div>`;
  }
  return `
    <table class="table">
      <thead>
        <tr>
          <th>Ø§Ù„Ù…Ø¨Ø§Ø¯Ø±Ø©</th>
          <th>Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</th>
          <th>Ø§Ù„Ù‡Ø¯Ù Ø§Ù„ØªØ´ØºÙŠÙ„ÙŠ</th>
          <th>Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ©</th>
          <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        ${items.map(i=>`
          <tr>
            <td>
              <div style="font-weight:850">${safe(i.code)} â€” ${safe(i.name)}</div>
              <div class="small">${safe(i.description)}</div>
            </td>
            <td>${deptName(i.department_id)}</td>
            <td class="small">${opName(i.operational_objective_id)}</td>
            <td>
              <div class="small">ØªÙ‚Ø¯ÙŠØ±ÙŠ: <b>${fmtMoney(i.budget?.estimated_cost||0)}</b></div>
              <div class="small">Ù…ØµØ±ÙˆÙ: ${fmtMoney(i.budget?.actual_expenses||0)}</div>
              <div class="small">Ø¥ÙŠØ±Ø§Ø¯: ${fmtMoney(i.budget?.actual_revenues||0)}</div>
            </td>
            <td>${statusBadge(i.status)}</td>
            <td><button class="btn ghost" data-open-initiative="${i.id}">ÙØªØ­</button></td>
          </tr>
        `).join("")}
      </tbody>
    </table>
  `;
}

/* ====== Views ====== */
function renderOverview(){
  const initiatives = Object.values(SSOT.initiatives||{});
  const active = initiatives.filter(i=>i.status==="active").length;
  const total = initiatives.length;
  const est = initiatives.reduce((s,i)=>s+(i.budget?.estimated_cost||0),0);
  const actExp = initiatives.reduce((s,i)=>s+(i.budget?.actual_expenses||0),0);
  const actRev = initiatives.reduce((s,i)=>s+(i.budget?.actual_revenues||0),0);
  const coverage = est ? Math.round((actRev/est)*100) : 0;
  const burn = est ? Math.round((actExp/est)*100) : 0;

  return `
    <div class="row">
      <div>
        <div class="badge ok">âœ… ÙˆØ¶Ø¹ Ø£ÙˆÙÙ„Ø§ÙŠÙ† â€¢ Ù†Ù…ÙˆØ°Ø¬ Ù…Ø¹Ø§ÙŠÙ†Ø©</div>
        <div style="margin-top:8px; font-size:20px; font-weight:900">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</div>
        <div class="small">Ù…Ù„Ø®Øµ Ø³Ø±ÙŠØ¹ Ù„Ù„Ù…Ø¨Ø§Ø¯Ø±Ø§Øª ÙˆØ§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ§Øª ÙˆØ§Ù„Ù…Ø¤Ø´Ø±Ø§Øª (Ø¨ÙŠØ§Ù†Ø§Øª Ø¹ÙŠÙ†Ø© Ù…Ù† SSOT).</div>
      </div>
      <div class="btns">
        <button class="btn" onclick="location.hash='#/initiatives'">Ø§Ø³ØªØ¹Ø±Ø§Ø¶ Ø§Ù„Ù…Ø¨Ø§Ø¯Ø±Ø§Øª</button>
        <button class="btn ghost" onclick="openSSOT()">Ø¹Ø±Ø¶ SSOT (Ù…Ø®ØªØµØ±)</button>
      </div>
    </div>

    <div class="hr"></div>

    <div class="grid cols-3">
      ${kpiCard("Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø¨Ø§Ø¯Ø±Ø§Øª", `<span style="font-family:var(--mono)">${total}</span>`, `<span class="badge ok">Ù†Ø´Ø·Ø©: ${active}</span>`)}
      ${kpiCard("Ø§Ù„ØªÙƒÙ„ÙØ© Ø§Ù„ØªÙ‚Ø¯ÙŠØ±ÙŠØ©", fmtMoney(est), `<span class="badge warn">Ø­Ø±Ù‚: ${burn}%</span>`)}
      ${kpiCard("Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ø§Ù„ÙØ¹Ù„ÙŠØ© Ø§Ù„Ù…Ø³Ø¬Ù„Ø©", fmtMoney(actRev), `<span class="badge ok">ØªØºØ·ÙŠØ©: ${coverage}%</span>`)}
    </div>

    <div class="grid cols-2" style="margin-top:12px">
      <div class="card">
        <h3>Ø£Ø­Ø¯Ø« Ø§Ù„Ù…Ø¨Ø§Ø¯Ø±Ø§Øª</h3>
        ${renderInitiativesTable(initiatives.slice(0,8))}
      </div>

      <div class="card">
        <h3>Ù‚ÙŠÙ… ÙˆÙ‡ÙˆÙŠØ© Ø§Ù„Ø¬Ù…Ø¹ÙŠØ©</h3>
        <div class="chips">
          ${(SSOT.identity?.values||[]).map(v=>`<span class="chip">${v.icon||"â€¢"} ${v.name}</span>`).join("")}
        </div>
        <div class="hr"></div>
        <div class="small"><b>Ø§Ù„Ø±Ø¤ÙŠØ©:</b> ${safe(SSOT.identity?.vision)}</div>
        <div class="small" style="margin-top:8px"><b>Ø§Ù„Ø±Ø³Ø§Ù„Ø©:</b> ${safe(SSOT.identity?.mission)}</div>
      </div>
    </div>
  `;
}

function renderStrategy(){
  const p = SSOT.lookups?.perspectives || [];
  const so = SSOT.lookups?.strategic_objectives || [];
  const op = SSOT.lookups?.operational_objectives || [];
  const initiatives = Object.values(SSOT.initiatives||{});

  const soByP = Object.fromEntries(p.map(x=>[x.id, so.filter(s=>s.perspective_id===x.id)]));
  const opBySO = Object.fromEntries(so.map(s=>[s.id, op.filter(o=>o.so_id===s.id)]));

  const countInits = (opId)=> initiatives.filter(i=>i.operational_objective_id===opId).length;

  return `
    <div class="row">
      <div>
        <div style="font-size:20px; font-weight:900">Ø§Ù„Ø®Ø·Ø© Ø§Ù„Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ©</div>
        <div class="small">Ø¹Ø±Ø¶ Ù…ØªØ±Ø§Ø¨Ø· (BSC) Ù…Ù† Ø§Ù„Ù…Ù†Ø¸ÙˆØ± -> Ø§Ù„Ø£Ù‡Ø¯Ø§Ù Ø§Ù„Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ© -> Ø§Ù„Ø£Ù‡Ø¯Ø§Ù Ø§Ù„ØªØ´ØºÙŠÙ„ÙŠØ© -> Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø¨Ø§Ø¯Ø±Ø§Øª Ø§Ù„Ù…Ø±ØªØ¨Ø·Ø©.</div>
      </div>
      <div class="btns">
        <button class="btn ghost" onclick="location.hash='#/initiatives'">ÙØªØ­ Ø§Ù„Ù…Ø¨Ø§Ø¯Ø±Ø§Øª</button>
      </div>
    </div>

    <div class="hr"></div>

    <div class="grid">
      ${p.map(pp=>`
        <div class="card">
          <div class="row">
            <div style="font-weight:900">${pp.icon||"ğŸ“"} ${pp.name}</div>
            <span class="badge">${pp.code}</span>
          </div>

          <div class="hr"></div>

          ${(soByP[pp.id]||[]).map(s=>`
            <div class="card" style="background:rgba(17,27,46,.35)">
              <div class="row">
                <div style="font-weight:850">${s.code} â€” ${s.name}</div>
                <span class="badge">Ø£Ù‡Ø¯Ø§Ù ØªØ´ØºÙŠÙ„ÙŠØ©: ${(opBySO[s.id]||[]).length}</span>
              </div>

              <div class="hr"></div>

              <table class="table">
                <thead><tr><th>Ø§Ù„Ù‡Ø¯Ù Ø§Ù„ØªØ´ØºÙŠÙ„ÙŠ</th><th>Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø¨Ø§Ø¯Ø±Ø§Øª</th><th></th></tr></thead>
                <tbody>
                  ${(opBySO[s.id]||[]).map(o=>`
                    <tr>
                      <td>${o.code} â€” ${o.name}</td>
                      <td><span class="badge ok">${countInits(o.id)}</span></td>
                      <td><button class="btn ghost" onclick="location.hash='#/initiatives?q='+encodeURIComponent(o.code)">Ø¹Ø±Ø¶</button></td>
                    </tr>
                  `).join("")}
                </tbody>
              </table>
            </div>
          `).join("") || `<div class="small">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ù‡Ø¯Ø§Ù Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ© Ø¶Ù…Ù† Ù‡Ø°Ø§ Ø§Ù„Ù…Ù†Ø¸ÙˆØ±.</div>`}
        </div>
      `).join("")}
    </div>
  `;
}

function renderInitiatives(query){
  const all = Object.values(SSOT.initiatives||{});

  // Ø³ÙŠØ§Ø³Ø© Ø¥Ø¸Ù‡Ø§Ø± Ù…Ø¨Ø§Ø¯Ø±Ø§Øª system_admin_only: ÙÙŠ Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© Ù†Ø¹Ø±Ø¶Ù‡Ø§ Ù…Ø¹ ÙˆØ³Ù… ÙˆØ§Ø¶Ø­
  const q = (query||"").toLowerCase();
  const filtered = !q ? all : all.filter(i=>{
    const hay = [
      i.id, i.code, i.name, i.description,
      deptName(i.department_id),
      opName(i.operational_objective_id)
    ].join(" ").toLowerCase();
    return hay.includes(q);
  });

  const publicCount = filtered.filter(x=>x.visibility!=="system_admin_only").length;
  const internalCount = filtered.filter(x=>x.visibility==="system_admin_only").length;

  return `
    <div class="row">
      <div>
        <div style="font-size:20px; font-weight:900">Ø§Ù„Ù…Ø¨Ø§Ø¯Ø±Ø§Øª</div>
        <div class="small">
          ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¨Ø­Ø« Ù…Ù† Ù…Ø±Ø¨Ø¹ Ø§Ù„Ø¨Ø­Ø« Ø£Ø¹Ù„Ù‰ Ø§Ù„ØµÙØ­Ø©.
          ${query ? ` â€¢ Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¨Ø­Ø«: <b>${safe(query)}</b>` : ``}
        </div>
      </div>
      <div class="btns">
        <button class="btn ghost" onclick="location.hash='#/initiatives'">Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ÙƒÙ„</button>
        <button class="btn" onclick="openSSOT()">SSOT</button>
      </div>
    </div>

    <div class="hr"></div>

    <div class="chips">
      <span class="chip">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: <b>${filtered.length}</b></span>
      <span class="chip">Ø¹Ø§Ù…Ø©: <b>${publicCount}</b></span>
      <span class="chip">Ø¯Ø§Ø®Ù„ÙŠØ© (system_admin_only): <b>${internalCount}</b></span>
    </div>

    <div class="hr"></div>

    <div class="card">
      <h3>Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¨Ø§Ø¯Ø±Ø§Øª</h3>
      ${renderInitiativesTable(filtered)}
      <div class="small" style="margin-top:10px">
        Ù…Ù„Ø§Ø­Ø¸Ø©: Ø§Ù„Ù…Ø¨Ø§Ø¯Ø±Ø§Øª Ø§Ù„Ù…ÙˆØ³ÙˆÙ…Ø© <b>system_admin_only</b> ØªÙØ¹Ø±Ø¶ Ù‡Ù†Ø§ Ù„Ø£ØºØ±Ø§Ø¶ Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© ÙÙ‚Ø· ÙˆÙŠÙ…ÙƒÙ† Ø¥Ø®ÙØ§Ø¤Ù‡Ø§ Ø­Ø³Ø¨ Ø§Ù„Ø¯ÙˆØ± Ø¯Ø§Ø®Ù„ Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„ÙØ¹Ù„ÙŠ.
      </div>
    </div>
  `;
}

function renderTimeline(){
  const initiatives = Object.values(SSOT.initiatives||{});
  const rows = initiatives
    .map(i=>{
      const s = i.dates?.start || "";
      const e = i.dates?.end || "";
      return { id:i.id, code:i.code, name:i.name, dept:deptName(i.department_id), start:s, end:e, status:i.status };
    })
    .sort((a,b)=> String(a.start).localeCompare(String(b.start)));

  return `
    <div class="row">
      <div>
        <div style="font-size:20px; font-weight:900">Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø²Ù…Ù†ÙŠ</div>
        <div class="small">Ù…Ù„Ø®Øµ ØªÙˆØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø¡/Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡ Ù„Ù„Ù…Ø¨Ø§Ø¯Ø±Ø§Øª (Ù…Ù† SSOT).</div>
      </div>
      <div class="btns">
        <button class="btn ghost" onclick="location.hash='#/initiatives'">ÙØªØ­ Ø§Ù„Ù…Ø¨Ø§Ø¯Ø±Ø§Øª</button>
      </div>
    </div>

    <div class="hr"></div>

    <div class="card">
      <h3>Ø§Ù„Ø®Ø· Ø§Ù„Ø²Ù…Ù†ÙŠ (Tabular)</h3>
      <table class="table">
        <thead><tr><th>Ø§Ù„Ù…Ø¨Ø§Ø¯Ø±Ø©</th><th>Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</th><th>Ø§Ù„Ø¨Ø¯Ø¡</th><th>Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡</th><th>Ø§Ù„Ø­Ø§Ù„Ø©</th><th></th></tr></thead>
        <tbody>
          ${rows.map(r=>`
            <tr>
              <td><b>${safe(r.code)}</b> â€” ${safe(r.name)}</td>
              <td>${safe(r.dept)}</td>
              <td>${safe(r.start)}</td>
              <td>${safe(r.end)}</td>
              <td>${statusBadge(r.status)}</td>
              <td><button class="btn ghost" data-open-initiative="${r.id}">ÙØªØ­</button></td>
            </tr>
          `).join("")}
        </tbody>
      </table>
    </div>
  `;
}

function renderInventory(){
  const items = SSOT.inventory?.items || [];
  const moves = SSOT.inventory?.movements || [];
  const low = items.filter(x=> (x.qty||0) <= (x.min||0)).length;

  return `
    <div class="row">
      <div>
        <div style="font-size:20px; font-weight:900">Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</div>
        <div class="small">Ø¹Ø±Ø¶ Ø´Ø¨ÙƒØ©/Ø¬Ø¯ÙˆÙ„ Ù„Ù„Ù…Ø®Ø²ÙˆÙ† + Ø­Ø±ÙƒØ§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„/Ø§Ù„Ø®Ø±ÙˆØ¬ (Ø¨ÙŠØ§Ù†Ø§Øª Ø¹ÙŠÙ†Ø©).</div>
      </div>
      <div class="chips">
        <span class="chip">Ø§Ù„Ø£ØµÙ†Ø§Ù: <b>${items.length}</b></span>
        <span class="chip">ØªØ­Øª Ø§Ù„Ø­Ø¯: <b>${low}</b></span>
      </div>
    </div>

    <div class="hr"></div>

    <div class="grid cols-2">
      <div class="card">
        <h3>Ø§Ù„Ø£ØµÙ†Ø§Ù</h3>
        <table class="table">
          <thead><tr><th>Ø§Ù„ØµÙ†Ù</th><th>Ø§Ù„ÙƒÙ…ÙŠØ©</th><th>Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰</th><th>Ø¢Ø®Ø± ØªÙˆØ±ÙŠØ¯</th></tr></thead>
          <tbody>
            ${items.map(it=>{
              const warn = (it.qty||0) <= (it.min||0);
              return `
                <tr>
                  <td><b>${safe(it.name)}</b><div class="small">${safe(it.unit)}</div></td>
                  <td>${warn ? `<span class="badge warn">${safe(it.qty)}</span>` : `<span class="badge ok">${safe(it.qty)}</span>`}</td>
                  <td>${safe(it.min)}</td>
                  <td>${safe(it.last_in)}</td>
                </tr>
              `;
            }).join("")}
          </tbody>
        </table>
      </div>

      <div class="card">
        <h3>Ø­Ø±ÙƒØ§Øª Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</h3>
        <table class="table">
          <thead><tr><th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th><th>Ø§Ù„Ù†ÙˆØ¹</th><th>Ø§Ù„ØµÙ†Ù</th><th>Ø§Ù„ÙƒÙ…ÙŠØ©</th><th>Ù…Ù„Ø§Ø­Ø¸Ø©</th></tr></thead>
          <tbody>
            ${moves.map(m=>{
              const it = items.find(x=>x.id===m.item_id);
              const type = m.type==="in" ? `<span class="badge ok">Ø¯Ø®ÙˆÙ„</span>` : `<span class="badge warn">Ø®Ø±ÙˆØ¬</span>`;
              return `
                <tr>
                  <td>${safe(m.date)}</td>
                  <td>${type}</td>
                  <td>${safe(it?.name)}</td>
                  <td>${safe(m.qty)}</td>
                  <td class="small">${safe(m.note)} ${m.initiative_id? `â€¢ <button class="btn ghost" style="padding:4px 8px" data-open-initiative="${m.initiative_id}">ÙØªØ­ ${m.initiative_id}</button>`:""}</td>
                </tr>
              `;
            }).join("")}
          </tbody>
        </table>
        <div class="small" style="margin-top:10px">
          Ù…Ù„Ø§Ø­Ø¸Ø©: ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„ÙØ¹Ù„ÙŠ ÙŠÙ…ÙƒÙ† Ø±Ø¨Ø· <b>ØµØ±Ù Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</b> Ù…Ø¨Ø§Ø´Ø±Ø© Ø¨Ù…ØµØ±ÙˆÙ Ù…Ø¨Ø§Ø¯Ø±Ø© (Payment Method = inventory).
        </div>
      </div>
    </div>
  `;
}

function renderDonors(){
  const donors = SSOT.donors?.entities || [];
  const pledged = donors.reduce((s,d)=>s+(d.pledged||0),0);
  const paid = donors.reduce((s,d)=>s+(d.paid||0),0);

  return `
    <div class="row">
      <div>
        <div style="font-size:20px; font-weight:900">Ø§Ù„Ø¬Ù‡Ø§Øª Ø§Ù„Ù…Ø§Ù†Ø­Ø©</div>
        <div class="small">Ø¹Ø±Ø¶ Ø§Ù„Ø¬Ù‡Ø§Øª + Ø§Ù„ØªØ¹Ù‡Ø¯Ø§Øª + Ø§Ù„Ù…Ø³Ø¯Ø¯ (Ø¨ÙŠØ§Ù†Ø§Øª Ø¹ÙŠÙ†Ø© Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„ØªØ·ÙˆÙŠØ±).</div>
      </div>
      <div class="chips">
        <span class="chip">ØªØ¹Ù‡Ø¯Ø§Øª: <b>${fmtMoney(pledged)}</b></span>
        <span class="chip">Ù…Ø³Ø¯Ø¯: <b>${fmtMoney(paid)}</b></span>
      </div>
    </div>

    <div class="hr"></div>

    <div class="card">
      <h3>Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ù‡Ø§Øª</h3>
      <table class="table">
        <thead><tr><th>Ø§Ù„Ø¬Ù‡Ø©</th><th>Ø§Ù„Ù†ÙˆØ¹</th><th>Ø§Ù„ØªØ¹Ù‡Ø¯</th><th>Ø§Ù„Ù…Ø³Ø¯Ø¯</th><th>Ø§Ù„Ø­Ø§Ù„Ø©</th></tr></thead>
        <tbody>
          ${donors.map(d=>`
            <tr>
              <td><b>${safe(d.name)}</b><div class="small">${safe(d.id)}</div></td>
              <td>${safe(d.type)}</td>
              <td>${fmtMoney(d.pledged||0)}</td>
              <td>${fmtMoney(d.paid||0)}</td>
              <td>${d.status==="completed" ? `<span class="badge ok">Ù…ÙƒØªÙ…Ù„</span>` : `<span class="badge warn">Ù†Ø´Ø·</span>`}</td>
            </tr>
          `).join("")}
        </tbody>
      </table>
      <div class="small" style="margin-top:10px">
        ÙÙŠ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø¥Ù†ØªØ§Ø¬ÙŠØ©: ÙŠÙ…ÙƒÙ† Ø±Ø¨Ø· Ø§Ù„Ù…ØªØ¨Ø±Ø¹/Ø§Ù„Ø¬Ù‡Ø© Ø§Ù„Ù…Ø§Ù†Ø­Ø© Ø¨Ø§Ù„Ù…Ø§Ù„ÙŠØ© ÙˆØ§Ù„Ù…Ø¨Ø§Ø¯Ø±Ø§Øª Ù„Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø£Ø«Ø± ÙˆØ§Ù„ØµØ±Ù/Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯ Ø¨Ø´ÙƒÙ„ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠ.
      </div>
    </div>
  `;
}

function renderDeductions(){
  const subs = SSOT.deductions?.subscribers || [];
  const active = subs.filter(s=>s.status==="active").length;
  const late = subs.filter(s=>s.status==="late").length;
  const sum = subs.reduce((t,s)=>t+(s.amount||0),0);

  return `
    <div class="row">
      <div>
        <div style="font-size:20px; font-weight:900">Ø§Ù„Ù…Ø³ØªÙ‚Ø·Ø¹ÙŠÙ†</div>
        <div class="small">Ù…ØªØ§Ø¨Ø¹Ø© Ø´Ù‡Ø±ÙŠØ© (12 Ø´Ù‡Ø±) + Ø­Ø§Ù„Ø© Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… (Ø¨ÙŠØ§Ù†Ø§Øª Ø¹ÙŠÙ†Ø©).</div>
      </div>
      <div class="chips">
        <span class="chip">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: <b>${subs.length}</b></span>
        <span class="chip">Ù†Ø´Ø·: <b>${active}</b></span>
        <span class="chip">Ù…ØªØ¹Ø«Ø±: <b>${late}</b></span>
        <span class="chip">Ù‚ÙŠÙ…Ø© Ø´Ù‡Ø±ÙŠØ©: <b>${fmtMoney(sum)}</b></span>
      </div>
    </div>

    <div class="hr"></div>

    <div class="card">
      <h3>Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø³ØªÙ‚Ø·Ø¹ÙŠÙ†</h3>
      <table class="table">
        <thead><tr><th>Ø§Ù„Ù…Ø´ØªØ±Ùƒ</th><th>Ø§Ù„Ù‚ÙŠÙ…Ø©</th><th>Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… (Ø£Ø´Ù‡Ø±)</th><th>Ø¢Ø®Ø± Ø³Ø¯Ø§Ø¯</th><th>Ø§Ù„Ø­Ø§Ù„Ø©</th></tr></thead>
        <tbody>
          ${subs.map(s=>`
            <tr>
              <td><b>${safe(s.name)}</b><div class="small">${safe(s.id)}</div></td>
              <td>${fmtMoney(s.amount||0)}</td>
              <td>
                ${s.status==="late"
                  ? `<span class="badge warn">${safe(s.months_ok)}/12</span>`
                  : `<span class="badge ok">${safe(s.months_ok)}/12</span>`
                }
              </td>
              <td>${safe(s.last_paid)}</td>
              <td>${s.status==="late" ? `<span class="badge bad">Ù…ØªØ¹Ø«Ø±</span>` : `<span class="badge ok">Ù…Ù„ØªØ²Ù…</span>`}</td>
            </tr>
          `).join("")}
        </tbody>
      </table>

      <div class="hr"></div>

      <div class="btns">
        <button class="btn">Ø¥Ø±Ø³Ø§Ù„ ØªØ°ÙƒÙŠØ± ÙˆØ§ØªØ³Ø§Ø¨ (ÙˆÙ‡Ù…ÙŠ)</button>
        <button class="btn ghost">Ø¥Ø±Ø³Ø§Ù„ Ø´ÙƒØ± (ÙˆÙ‡Ù…ÙŠ)</button>
      </div>

      <div class="small" style="margin-top:10px">
        Ù…Ù„Ø§Ø­Ø¸Ø©: Ù‡Ø°Ù‡ Ù…Ø¹Ø§ÙŠÙ†Ø© Ø«Ø§Ø¨ØªØ©ØŒ Ø£Ø²Ø±Ø§Ø± Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨ Ù‡Ù†Ø§ Ù„Ø£ØºØ±Ø§Ø¶ Ø§Ù„Ø¹Ø±Ø¶ ÙÙ‚Ø·.
      </div>
    </div>
  `;
}

function renderTrainees(){
  const t = SSOT.trainees?.list || [];
  return `
    <div class="row">
      <div>
        <div style="font-size:20px; font-weight:900">Ø§Ù„Ù…ØªØ¯Ø±Ø¨ÙˆÙ†</div>
        <div class="small">ØªØªØ¨Ø¹ Ø§Ù„Ø¨Ø±Ø§Ù…Ø¬ Ø§Ù„ØªØ¯Ø±ÙŠØ¨ÙŠØ© (Ø¨ÙŠØ§Ù†Ø§Øª Ø¹ÙŠÙ†Ø©).</div>
      </div>
      <div class="chips">
        <span class="chip">Ø¹Ø¯Ø¯ Ø§Ù„Ù…ØªØ¯Ø±Ø¨ÙŠÙ†: <b>${t.length}</b></span>
      </div>
    </div>

    <div class="hr"></div>

    <div class="card">
      <h3>Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ØªØ¯Ø±Ø¨ÙŠÙ†</h3>
      <table class="table">
        <thead><tr><th>Ø§Ù„Ù…ØªØ¯Ø±Ø¨</th><th>Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬</th><th>Ø§Ù„ÙØªØ±Ø©</th><th>Ø§Ù„Ø­Ø§Ù„Ø©</th></tr></thead>
        <tbody>
          ${t.map(x=>`
            <tr>
              <td><b>${safe(x.name)}</b><div class="small">${safe(x.id)}</div></td>
              <td>${safe(x.program)}</td>
              <td class="small">${safe(x.start)} â†’ ${safe(x.end)}</td>
              <td>${x.status==="active" ? `<span class="badge ok">Ù†Ø´Ø·</span>` : `<span class="badge">â€”</span>`}</td>
            </tr>
          `).join("")}
        </tbody>
      </table>
    </div>
  `;
}

function renderExpenses(){
  const ex = SSOT.expenses?.ops || [];
  const sum = ex.reduce((s,x)=>s+(x.amount||0),0);

  return `
    <div class="row">
      <div>
        <div style="font-size:20px; font-weight:900">Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª Ø§Ù„ØªØ´ØºÙŠÙ„ÙŠØ©</div>
        <div class="small">Ø¹Ø±Ø¶ Ù…ØµØ±ÙˆÙØ§Øª ØªØ´ØºÙŠÙ„ÙŠØ© ÙˆØ±Ø¨Ø· Ø¨Ø¹Ø¶Ù‡Ø§ Ø¨Ø§Ù„Ù…Ø¨Ø§Ø¯Ø±Ø§Øª (Ø¹ÙŠÙ†Ø©).</div>
      </div>
      <div class="chips">
        <span class="chip">Ø¹Ø¯Ø¯ Ø§Ù„Ø³Ø¬Ù„Ø§Øª: <b>${ex.length}</b></span>
        <span class="chip">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: <b>${fmtMoney(sum)}</b></span>
      </div>
    </div>

    <div class="hr"></div>

    <div class="card">
      <h3>Ø³Ø¬Ù„ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª</h3>
      <table class="table">
        <thead><tr><th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th><th>Ø§Ù„ÙˆØµÙ</th><th>Ø§Ù„Ù‚ÙŠÙ…Ø©</th><th>Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹</th><th>Ø§Ù„Ù…Ø¨Ø§Ø¯Ø±Ø©</th></tr></thead>
        <tbody>
          ${ex.map(x=>`
            <tr>
              <td>${safe(x.date)}</td>
              <td><b>${safe(x.title)}</b><div class="small">${safe(x.note)}</div></td>
              <td>${fmtMoney(x.amount||0)}</td>
              <td class="small">${safe(x.method)}</td>
              <td>
                ${x.initiative_id
                  ? `<button class="btn ghost" data-open-initiative="${x.initiative_id}">ÙØªØ­ ${x.initiative_id}</button>`
                  : `<span class="small">ØªØ´ØºÙŠÙ„ÙŠ Ø¹Ø§Ù…</span>`
                }
              </td>
            </tr>
          `).join("")}
        </tbody>
      </table>

      <div class="small" style="margin-top:10px">
        ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„ÙØ¹Ù„ÙŠ: ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© Ø®ÙŠØ§Ø± <b>ØµØ±Ù Ù…Ù† Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</b> ÙƒØ·Ø±ÙŠÙ‚Ø© Ø¯ÙØ¹ Ù„ØªÙˆÙ„ÙŠØ¯ Ø­Ø±ÙƒØ© Ù…Ø®Ø²ÙˆÙ† + Ù…ØµØ±ÙˆÙ Ù…Ø±ØªØ¨Ø·.
      </div>
    </div>
  `;
}

function renderActivity(){
  const log = SSOT.activity_log || [];
  return `
    <div class="row">
      <div>
        <div style="font-size:20px; font-weight:900">Ø³Ø¬Ù„ Ø§Ù„Ù†Ø´Ø§Ø·</div>
        <div class="small">ØªØªØ¨Ø¹ Ø§Ù„Ø£Ø­Ø¯Ø§Ø« (EventLog) Ø¨ØµÙŠØºØ© Append-Only (Ø¹ÙŠÙ†Ø©).</div>
      </div>
      <div class="btns">
        <button class="btn ghost" onclick="openSSOT()">Ø¹Ø±Ø¶ SSOT</button>
      </div>
    </div>

    <div class="hr"></div>

    <div class="card">
      <h3>Ø§Ù„Ø£Ø­Ø¯Ø§Ø«</h3>
      <table class="table">
        <thead><tr><th>Ø§Ù„ÙˆÙ‚Øª</th><th>Ø§Ù„Ù…Ù†ÙÙ‘Ø°</th><th>Ø§Ù„Ø­Ø¯Ø«</th><th>ØªÙØ§ØµÙŠÙ„</th></tr></thead>
        <tbody>
          ${log.map(e=>`
            <tr>
              <td class="small">${fmtDate(e.ts)}</td>
              <td>${staffName(e.actor)}</td>
              <td><span class="badge">${safe(e.action)}</span></td>
              <td class="small">${safe(e.details)}</td>
            </tr>
          `).join("")}
        </tbody>
      </table>
      <div class="small" style="margin-top:10px">
        Ù…Ù„Ø§Ø­Ø¸Ø©: ÙÙŠ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø¥Ù†ØªØ§Ø¬ÙŠØ©ØŒ ÙƒÙ„ ØªØ¹Ø¯ÙŠÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙŠÙØ³Ø¬Ù‘Ù„ ÙƒØ­Ø¯Ø« Ù…Ø¹ Ù‚ÙŠÙˆØ¯ RBAC Ùˆ EventSpecs.
      </div>
    </div>
  `;
}

function renderRBAC(){
  const roles = SSOT.rbac?.roles || {};
  const keys = Object.keys(roles);

  return `
    <div class="row">
      <div>
        <div style="font-size:20px; font-weight:900">Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª (RBAC)</div>
        <div class="small">Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø¯ÙˆØ§Ø± ÙˆØ§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª (Ø¹ÙŠÙ†Ø©).</div>
      </div>
      <div class="chips">
        <span class="chip">Ø§Ù„Ø£Ø¯ÙˆØ§Ø±: <b>${keys.length}</b></span>
      </div>
    </div>

    <div class="hr"></div>

    <div class="grid cols-2">
      ${keys.map(k=>{
        const r = roles[k];
        return `
          <div class="card">
            <div class="row">
              <div style="font-weight:900">${safe(r.name)}</div>
              <span class="badge">${k}</span>
            </div>
            <div class="hr"></div>
            <div class="small"><b>Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª:</b></div>
            <div class="chips" style="margin-top:8px">
              ${(r.permissions||[]).map(p=>`<span class="chip">${p}</span>`).join("") || `<span class="small">â€”</span>`}
            </div>
          </div>
        `;
      }).join("")}
    </div>
  `;
}

function renderSettings(){
  const si = SSOT.system_info || {};
  const cur = SSOT.ui_config?.currency?.default || "SR";
  return `
    <div class="row">
      <div>
        <div style="font-size:20px; font-weight:900">Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</div>
        <div class="small">Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¹Ø§Ù…Ø© (ÙÙŠ Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø­ÙØ¸ ÙØ¹Ù„ÙŠ).</div>
      </div>
      <div class="btns">
        <button class="btn ghost" onclick="openSSOT()">SSOT</button>
      </div>
    </div>

    <div class="hr"></div>

    <div class="grid cols-2">
      <div class="card">
        <h3>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…</h3>
        <div class="small"><b>Ø§Ù„Ø§Ø³Ù…:</b> ${safe(si.name)}</div>
        <div class="small" style="margin-top:6px"><b>Ø§Ù„Ø¬Ù‡Ø©:</b> ${safe(si.organization)}</div>
        <div class="small" style="margin-top:6px"><b>Ø§Ù„ØªØ±Ø®ÙŠØµ:</b> ${safe(si.license)}</div>
        <div class="small" style="margin-top:6px"><b>Ø§Ù„Ø³Ù†Ø©:</b> ${safe(si.fiscal_year?.year)}</div>
        <div class="small" style="margin-top:6px"><b>Ø§Ù„Ø¥ØµØ¯Ø§Ø±:</b> ${safe(si.version)}</div>
        <div class="small" style="margin-top:6px"><b>Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«:</b> ${safe(si.last_updated)}</div>
      </div>

      <div class="card">
        <h3>Ø§Ù„Ø¹Ù…Ù„Ø©</h3>
        <div class="small">Ø§Ù„Ø¹Ù…Ù„Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©: <b>${cur}</b></div>
        <div class="hr"></div>
        <div class="btns">
          <button class="btn" onclick="mockChangeCurrency('SR')">ØªØ¹ÙŠÙŠÙ† SR (ÙˆÙ‡Ù…ÙŠ)</button>
          <button class="btn ghost" onclick="mockChangeCurrency('SAR')">ØªØ¹ÙŠÙŠÙ† SAR (ÙˆÙ‡Ù…ÙŠ)</button>
          <button class="btn ghost" onclick="mockChangeCurrency('USD')">ØªØ¹ÙŠÙŠÙ† USD (ÙˆÙ‡Ù…ÙŠ)</button>
        </div>
        <div class="small" style="margin-top:10px">Ù…Ù„Ø§Ø­Ø¸Ø©: Ù‡Ø°Ø§ Ù„Ù„ØªØ¬Ø±Ø¨Ø© ÙÙ‚Ø· Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©.</div>
      </div>
    </div>

    <div class="card" style="margin-top:12px">
      <h3>Ø®Ø·ÙˆØ§Øª Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù‚ØªØ±Ø­Ø© (UI)</h3>
      <div class="small">Ù‡Ø°Ø§ ØªØ±ØªÙŠØ¨ Ø¥Ø±Ø´Ø§Ø¯ÙŠ ÙŠÙ…ÙƒÙ† Ø§Ø¹ØªÙ…Ø§Ø¯Ù‡ ÙÙŠ Ø´Ø§Ø´Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¯Ø§Ø®Ù„ Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„ÙØ¹Ù„ÙŠ:</div>
      <div class="hr"></div>
      <div class="chips">
        ${[
          "Ø§Ø³Ù… Ø§Ù„Ø¬Ù‡Ø©","Ø±Ù‚Ù… Ø§Ù„ØªØ±Ø®ÙŠØµ","Ø³Ù†Ø© Ø§Ù„Ø®Ø·Ø©","Ø§Ù„Ø±Ø¤ÙŠØ©","Ø§Ù„Ø±Ø³Ø§Ù„Ø©","Ø§Ù„Ù‚ÙŠÙ…","ØªØ­Ù„ÙŠÙ„ SWOT","Ø§Ù„Ù…Ø­Ø§ÙˆØ±","Ø§Ù„Ø£Ù‡Ø¯Ø§Ù Ø§Ù„Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ©",
          "Ø§Ù„Ø£Ù‡Ø¯Ø§Ù Ø§Ù„ØªØ´ØºÙŠÙ„ÙŠØ©","Ø§Ù„Ø¥Ø¯Ø§Ø±Ø§Øª","Ø§Ù„Ù…Ø¨Ø§Ø¯Ø±Ø§Øª","Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†"
        ].map(x=>`<span class="chip">${x}</span>`).join("")}
      </div>
    </div>
  `;
}

/* ====== Modal (Initiative 360) ====== */
const modalBackdrop = document.getElementById("modalBackdrop");
const mClose = document.getElementById("mClose");

function openModal(){
  modalBackdrop.style.display = "flex";
  document.body.style.overflow = "hidden";
}
function closeModal(){
  modalBackdrop.style.display = "none";
  document.body.style.overflow = "";
}
mClose.addEventListener("click", closeModal);
modalBackdrop.addEventListener("click", (e)=>{ if(e.target === modalBackdrop) closeModal(); });
window.addEventListener("keydown", (e)=>{ if(e.key==="Escape" && modalBackdrop.style.display==="flex") closeModal(); });

function wireInitiativeButtons(){
  document.querySelectorAll('[data-open-initiative]').forEach(btn=>{
    btn.addEventListener('click', ()=>{
      const id = btn.getAttribute('data-open-initiative');
      openInitiative(id);
    });
  });
}

function openInitiative(id){
  const i = SSOT.initiatives?.[id];
  if(!i){
    openModal();
    document.getElementById("mTitle").textContent = "ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯";
    document.getElementById("mSub").textContent = "Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø¨Ø§Ø¯Ø±Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© Ø¯Ø§Ø®Ù„ SSOT.";
    document.getElementById("mChips").innerHTML = "";
    document.getElementById("mTabs").innerHTML = "";
    document.getElementById("mBody").innerHTML = `<div class="small">ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…Ø¹Ø±Ù: <b>${safe(id)}</b></div>`;
    document.getElementById("mFoot").textContent = "â€”";
    return;
  }

  const dept = deptName(i.department_id);
  const owner = staffName(i.responsible_staff_id);
  const op = opName(i.operational_objective_id);

  document.getElementById("mTitle").textContent = `${safe(i.code)} â€” ${safe(i.name)}`;
  document.getElementById("mSub").textContent = `${dept} â€¢ Ø§Ù„Ù…Ø§Ù„Ùƒ: ${owner} â€¢ ${op}`;
  document.getElementById("mChips").innerHTML = `
    <span class="chip">ID: ${safe(i.id)}</span>
    <span class="chip">ØªÙ…ÙˆÙŠÙ„: ${safe(i.funding_type||"â€”")}</span>
    <span class="chip">ÙØ¦Ø©/Ù…Ø³ØªÙ‡Ø¯Ù: ${safe(i.target_group||"â€”")}</span>
    <span class="chip">Ø§Ù„Ø±Ø¤ÙŠØ©: ${safe(i.visibility||"public")}</span>
  `;

  const tabs = [
    {k:"overview", t:"Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø©"},
    {k:"milestones", t:"Ø§Ù„Ù…Ø¹Ø§Ù„Ù…"},
    {k:"indicators", t:"Ø§Ù„Ù…Ø¤Ø´Ø±Ø§Øª"},
    {k:"risks", t:"Ø§Ù„Ù…Ø®Ø§Ø·Ø±"},
    {k:"checklist", t:"Ø§Ù„ØªØ´ÙŠÙƒ Ù„ÙŠØ³Øª"},
    {k:"budget", t:"Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ©"},
    {k:"raw", t:"RAW"}
  ];

  const mTabs = document.getElementById("mTabs");
  mTabs.innerHTML = tabs.map((x,idx)=>`<div class="tab ${idx===0?'active':''}" data-tab="${x.k}">${x.t}</div>`).join("");

  function setTab(key){
    mTabs.querySelectorAll(".tab").forEach(t=>t.classList.toggle("active", t.dataset.tab===key));
    document.getElementById("mBody").innerHTML = renderInitiativeTab(i, key);
    document.getElementById("mFoot").textContent =
      `Ø§Ù„Ø­Ø§Ù„Ø©: ${safe(i.status)} â€¢ Ø§Ù„ÙØªØ±Ø©: ${safe(i.dates?.start)} â†’ ${safe(i.dates?.end)} â€¢ Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: ${safe(SSOT.system_info?.last_updated)}`;
  }

  mTabs.querySelectorAll(".tab").forEach(t=>{
    t.addEventListener("click", ()=> setTab(t.dataset.tab));
  });

  setTab("overview");
  openModal();
}

function renderInitiativeTab(i, key){
  if(key==="overview"){
    return `
      <div class="card" style="background:rgba(17,27,46,.35)">
        <h3>Ø§Ù„ÙˆØµÙ</h3>
        <div class="small">${safe(i.description)}</div>
        <div class="hr"></div>
        <div class="grid cols-2">
          <div class="card" style="background:rgba(15,23,42,.6)">
            <h3>Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©</h3>
            <div class="small"><b>Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©:</b> ${deptName(i.department_id)}</div>
            <div class="small" style="margin-top:6px"><b>Ø§Ù„Ù‡Ø¯Ù Ø§Ù„ØªØ´ØºÙŠÙ„ÙŠ:</b> ${opName(i.operational_objective_id)}</div>
            <div class="small" style="margin-top:6px"><b>Ø§Ù„Ù…Ø§Ù„Ùƒ:</b> ${staffName(i.responsible_staff_id)}</div>
            <div class="small" style="margin-top:6px"><b>Ø§Ù„Ø­Ø§Ù„Ø©:</b> ${statusBadge(i.status)}</div>
          </div>
          <div class="card" style="background:rgba(15,23,42,.6)">
            <h3>Ø§Ù„Ø®Ø· Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ/Ø§Ù„Ù…Ø³ØªÙ‡Ø¯Ù</h3>
            <div class="small"><b>Baseline:</b> ${safe(i.baseline?.value)} â€¢ ${safe(i.baseline?.date)}</div>
            <div class="small" style="margin-top:6px"><b>Target:</b> ${safe(i.target?.value)}</div>
            <div class="small" style="margin-top:6px"><b>Ø§Ù„ÙØªØ±Ø©:</b> ${safe(i.dates?.start)} â†’ ${safe(i.dates?.end)}</div>
          </div>
        </div>
      </div>
    `;
  }

  if(key==="milestones"){
    const ms = i.milestones || [];
    if(!ms.length) return `<div class="small">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¹Ø§Ù„Ù… Ù…Ø³Ø¬Ù„Ø©.</div>`;
    return `
      <table class="table">
        <thead><tr><th>Ø§Ù„Ù…Ø¹Ù„Ù…</th><th>Ø§Ù„Ù…Ø±Ø­Ù„Ø©</th><th>Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…Ø³ØªÙ‡Ø¯Ù</th><th>Ø§Ù„Ø­Ø§Ù„Ø©</th></tr></thead>
        <tbody>
          ${ms.map(m=>`
            <tr>
              <td><b>${safe(m.title)}</b><div class="small">${safe(m.id)}</div></td>
              <td>${safe(m.phase)}</td>
              <td>${safe(m.target_date)}</td>
              <td>${safe(m.status)}</td>
            </tr>
          `).join("")}
        </tbody>
      </table>
    `;
  }

  if(key==="indicators"){
    const ind = i.indicators || [];
    if(!ind.length) return `<div class="small">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¤Ø´Ø±Ø§Øª Ù…Ø³Ø¬Ù„Ø©.</div>`;
    return `
      <table class="table">
        <thead><tr><th>Ø§Ù„Ù…Ø¤Ø´Ø±</th><th>Ø§Ù„Ù†ÙˆØ¹</th><th>Ø§Ù„ØªÙƒØ±Ø§Ø±</th><th>Ø§Ù„ÙˆØ­Ø¯Ø©</th><th>Ø§Ù„Ù…ØµØ¯Ø±</th></tr></thead>
        <tbody>
          ${ind.map(x=>`
            <tr>
              <td><b>${safe(x.name)}</b><div class="small">${safe(x.id)}</div></td>
              <td>${safe(x.type)}</td>
              <td>${safe(x.measurement_frequency)}</td>
              <td>${safe(x.unit)}</td>
              <td class="small">${safe(x.data_source)}</td>
            </tr>
          `).join("")}
        </tbody>
      </table>
    `;
  }

  if(key==="risks"){
    const rs = i.risks || [];
    if(!rs.length) return `<div class="small">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø®Ø§Ø·Ø± Ù…Ø³Ø¬Ù„Ø©.</div>`;
    return `
      <table class="table">
        <thead><tr><th>Ø§Ù„Ø®Ø·Ø±</th><th>Ø§Ù„Ø§Ø­ØªÙ…Ø§Ù„ÙŠØ©</th><th>Ø§Ù„Ø£Ø«Ø±</th><th>Ø§Ù„ØªØ®ÙÙŠÙ</th><th>Ø§Ù„Ù…Ø§Ù„Ùƒ</th></tr></thead>
        <tbody>
          ${rs.map(r=>`
            <tr>
              <td><b>${safe(r.title)}</b><div class="small">${safe(r.id)} â€¢ ${safe(r.status)}</div></td>
              <td>${riskBadge(r.probability)}</td>
              <td>${riskBadge(r.impact)}</td>
              <td class="small">${safe(r.mitigation)}</td>
              <td>${staffName(r.owner)}</td>
            </tr>
          `).join("")}
        </tbody>
      </table>
    `;
  }

  if(key==="checklist"){
    const cl = i.checklist || [];
    if(!cl.length) return `<div class="small">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ù†Ø§ØµØ± ØªØ´ÙŠÙƒ Ù„ÙŠØ³Øª.</div>`;
    return `
      <table class="table">
        <thead><tr><th>Ø§Ù„Ø¹Ù†ØµØ±</th><th>Ø§Ù„Ø­Ø§Ù„Ø©</th></tr></thead>
        <tbody>
          ${cl.map(c=>`
            <tr>
              <td><b>${safe(c.title)}</b><div class="small">${safe(c.id)}</div></td>
              <td>${safe(c.status)}</td>
            </tr>
          `).join("")}
        </tbody>
      </table>
    `;
  }

  if(key==="budget"){
    const b = i.budget || {};
    const est = b.estimated_cost || 0;
    const exp = b.actual_expenses || 0;
    const rev = b.actual_revenues || 0;
    const burn = est ? Math.round((exp/est)*100) : 0;
    const cov = est ? Math.round((rev/est)*100) : 0;

    return `
      <div class="grid cols-3">
        ${kpiCard("ØªÙ‚Ø¯ÙŠØ±ÙŠ", fmtMoney(est), `<span class="badge warn">Ø­Ø±Ù‚: ${burn}%</span>`)}
        ${kpiCard("Ù…ØµØ±ÙˆÙ", fmtMoney(exp), `<span class="badge">${safe(b.currency||SSOT.ui_config?.currency?.default||"SR")}</span>`)}
        ${kpiCard("Ø¥ÙŠØ±Ø§Ø¯", fmtMoney(rev), `<span class="badge ok">ØªØºØ·ÙŠØ©: ${cov}%</span>`)}
      </div>
      ${b.budget_note ? `<div class="card" style="margin-top:12px;background:rgba(17,27,46,.35)"><h3>Ù…Ù„Ø§Ø­Ø¸Ø©</h3><div class="small">${safe(b.budget_note)}</div></div>`:""}
      <div class="card" style="margin-top:12px;background:rgba(17,27,46,.35)">
        <h3>ØµØ±Ù Ù…Ù† Ø§Ù„Ù…Ø®Ø²ÙˆÙ† (Ù…Ù†Ø·Ù‚ÙŠÙ‹Ø§)</h3>
        <div class="small">
          Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹ <b>inventory</b>:
          ÙŠØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø±ÙƒØ© Ù…Ø®Ø²ÙˆÙ† (out) + ØªØ³Ø¬ÙŠÙ„ Ù…ØµØ±ÙˆÙ Ù…Ø±ØªØ¨Ø· Ø¨Ø§Ù„Ù…Ø¨Ø§Ø¯Ø±Ø© ÙÙŠ Ù†ÙØ³ Ø§Ù„Ø­Ø¯Ø«.
        </div>
      </div>
    `;
  }

  if(key==="raw"){
    return `<pre class="code">${escapeHtml(JSON.stringify(i, null, 2))}</pre>`;
  }

  return `<div class="small">â€”</div>`;
}

function escapeHtml(str){
  return String(str)
    .replaceAll("&","&amp;")
    .replaceAll("<","&lt;")
    .replaceAll(">","&gt;")
    .replaceAll('"',"&quot;")
    .replaceAll("'","&#039;");
}

/* ====== SSOT Quick View ====== */
function openSSOT(){
  const summary = {
    system_info: SSOT.system_info,
    identity: SSOT.identity,
    counts: {
      initiatives: Object.keys(SSOT.initiatives||{}).length,
      staff: Object.keys(SSOT.staff||{}).length,
      donors: (SSOT.donors?.entities||[]).length,
      subscribers: (SSOT.deductions?.subscribers||[]).length,
      inventory_items: (SSOT.inventory?.items||[]).length,
      expenses: (SSOT.expenses?.ops||[]).length
    }
  };

  openModal();
  document.getElementById("mTitle").textContent = "SSOT â€” Ù…Ø®ØªØµØ±";
  document.getElementById("mSub").textContent = "Ø¹Ø±Ø¶ Ù…Ø®ØªØµØ± Ù„Ø£Ù‡Ù… Ø£Ù‚Ø³Ø§Ù… SSOT (Ù„Ù„ØªØ­Ù‚Ù‚ Ø§Ù„Ø³Ø±ÙŠØ¹).";
  document.getElementById("mChips").innerHTML = `
    <span class="chip">Ø§Ù„Ù…Ø¨Ø§Ø¯Ø±Ø§Øª: ${summary.counts.initiatives}</span>
    <span class="chip">Ø§Ù„Ù…ÙˆØ¸ÙÙˆÙ†: ${summary.counts.staff}</span>
    <span class="chip">Ø§Ù„Ù…Ø®Ø²ÙˆÙ†: ${summary.counts.inventory_items}</span>
    <span class="chip">Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª: ${summary.counts.expenses}</span>
  `;
  document.getElementById("mTabs").innerHTML = `
    <div class="tab active" data-tab="summary">Ù…Ù„Ø®Øµ</div>
    <div class="tab" data-tab="raw">RAW</div>
  `;
  document.getElementById("mBody").innerHTML = `
    <div class="card" style="background:rgba(17,27,46,.35)">
      <h3>Ø§Ù„Ù…Ù„Ø®Øµ</h3>
      <div class="small"><b>Ø§Ù„Ø§Ø³Ù…:</b> ${safe(summary.system_info?.name)}</div>
      <div class="small" style="margin-top:6px"><b>Ø§Ù„Ø¬Ù‡Ø©:</b> ${safe(summary.system_info?.organization)}</div>
      <div class="small" style="margin-top:6px"><b>Ø§Ù„Ø¥ØµØ¯Ø§Ø±:</b> ${safe(summary.system_info?.version)}</div>
      <div class="small" style="margin-top:6px"><b>Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«:</b> ${safe(summary.system_info?.last_updated)}</div>
      <div class="hr"></div>
      <div class="small"><b>Ø§Ù„Ø±Ø¤ÙŠØ©:</b> ${safe(summary.identity?.vision)}</div>
      <div class="small" style="margin-top:6px"><b>Ø§Ù„Ø±Ø³Ø§Ù„Ø©:</b> ${safe(summary.identity?.mission)}</div>
    </div>
  `;
  document.getElementById("mFoot").textContent = "SSOT Quick View â€¢ Offline";

  const tabs = document.getElementById("mTabs");
  tabs.querySelectorAll(".tab").forEach(t=>{
    t.addEventListener("click", ()=>{
      tabs.querySelectorAll(".tab").forEach(x=>x.classList.remove("active"));
      t.classList.add("active");
      if(t.dataset.tab==="raw"){
        document.getElementById("mBody").innerHTML = `<pre class="code">${escapeHtml(JSON.stringify(SSOT, null, 2))}</pre>`;
      } else {
        document.getElementById("mBody").innerHTML = `
          <div class="card" style="background:rgba(17,27,46,.35)">
            <h3>Ø§Ù„Ù…Ù„Ø®Øµ</h3>
            <div class="small"><b>Ø§Ù„Ø§Ø³Ù…:</b> ${safe(summary.system_info?.name)}</div>
            <div class="small" style="margin-top:6px"><b>Ø§Ù„Ø¬Ù‡Ø©:</b> ${safe(summary.system_info?.organization)}</div>
            <div class="small" style="margin-top:6px"><b>Ø§Ù„Ø¥ØµØ¯Ø§Ø±:</b> ${safe(summary.system_info?.version)}</div>
            <div class="small" style="margin-top:6px"><b>Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«:</b> ${safe(summary.system_info?.last_updated)}</div>
            <div class="hr"></div>
            <div class="small"><b>Ø§Ù„Ø±Ø¤ÙŠØ©:</b> ${safe(summary.identity?.vision)}</div>
            <div class="small" style="margin-top:6px"><b>Ø§Ù„Ø±Ø³Ø§Ù„Ø©:</b> ${safe(summary.identity?.mission)}</div>
          </div>
        `;
      }
    });
  });
}

/* ====== (ÙˆÙ‡Ù…ÙŠ) ØªØºÙŠÙŠØ± Ø¹Ù…Ù„Ø© Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© ====== */
function mockChangeCurrency(code){
  if(!SSOT.ui_config) SSOT.ui_config = {};
  if(!SSOT.ui_config.currency) SSOT.ui_config.currency = {};
  SSOT.ui_config.currency.default = code;
  route(); // Ø¥Ø¹Ø§Ø¯Ø© Ø±Ø³Ù… Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
}

/* ====== Search box -> route initiatives?q= ====== */
const qInput = document.getElementById("q");
let qTimer = null;

qInput.addEventListener("input", ()=>{
  clearTimeout(qTimer);
  qTimer = setTimeout(()=>{
    const val = (qInput.value||"").trim();
    // Ø¥Ø°Ø§ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙÙŠ Ø£ÙŠ ØµÙØ­Ø©: Ù†Ø¨Ø­Ø« Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…Ø¨Ø§Ø¯Ø±Ø§Øª
    if(val){
      location.hash = "#/initiatives?q=" + encodeURIComponent(val);
    }else{
      // Ø¥Ù† ÙƒØ§Ù† Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø¨Ø§Ø¯Ø±Ø§Øª Ù†Ø­Ø°Ù Ø§Ù„ÙÙ„ØªØ±ØŒ ÙˆØ¥Ù„Ø§ Ù†ØªØ±ÙƒÙ‡
      const current = (location.hash||"").replace("#/","").split("?")[0];
      if(current==="initiatives") location.hash = "#/initiatives";
    }
  }, 250);
});

/* ====== Boot ====== */
initHeader();
window.addEventListener("hashchange", route);
route();
</script>

</body>
</html>
